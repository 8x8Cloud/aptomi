# Definition of Twitter Analytics service
name: twitter-stats

components:

  - name: analytics_pipeline
    service: analytics_pipeline

  - name: tweepub
    code:
      type: aptomi/code/kubernetes-helm
      content:
        chart:
          name: boston-summit-charts/tweepub
        params:
          kafka.externalAddress: kafka-{{ .Components.analytics_pipeline.kafka.kafka }}
          kafka.topic: tweepub_{{ .User.Name }}
          twitter.appKey:
          twitter.appSecret:
          twitter.tokenKey:
          twitter.tokenSecret:
    dependencies:
      - analytics_pipeline

  - name: tweetics
    code:
      type: aptomi/code/kubernetes-helm
      content:
        chart:
          name: boston-summit-charts/tweetics
        params:
          spark.externalAddress: spark-{{ .Components.analytics_pipeline.spark.spark }}
          zookeeper.externalAddress: zk-{{ .Components.analytics_pipeline.kafka.zookeeper.zookeeper }}
          kafka.topic: tweepub_{{ .User.Name }}
          hdfs.externalAddress: hdfs://hdfs-namenode:8020/tweepub_{{ .User.Name }}
          hdfs.path: tweepub_{{ .User.Name }}
    dependencies:
      - analytics_pipeline

  - name: tweeviz
    code:
      type: aptomi/code/kubernetes-helm
      content:
        chart:
          name: boston-summit-charts/tweeviz
        params:
          hdfs.externalAddress: hdfs://hdfs-namenode:8020/tweepub_{{ .User.Name }}
          hdfs.path: tweepub_{{ .User.Name }}
    dependencies:
      - analytics_pipeline
