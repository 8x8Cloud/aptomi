# Definition of Kafka service
name: kafka

components:

  - name: zookeeper
    service: zookeeper

  - name: kafka
    discovery:
      url: "kafka-{{ .Discovery.instance }}-0.kafka-{{ .Discovery.instance }}:9092"
    code:
      type: aptomi/code/kubernetes-helm
      metadata:
        chartName: kafka-1.0.0
      params:
        cluster: "{{ .Labels.cluster }}"

        replicas: 1
        antiAffinity: "soft"

        zookeeper:
          externalAddress: "{{ .Discovery.zookeeper.zookeeper.url }}"

    dependencies:
      - zookeeper
