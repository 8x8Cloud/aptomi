# Definition of Kafka service
- kind: service

  metadata:
    namespace: main
    name: kafka

  spec:
    owner: cn=Frank,ou=people,o=aptomiOrg

    components:

      - name: zookeeper
        service: zookeeper

      - name: kafka
        discovery:
          url: "kafka-{{ .Discovery.instance }}-0.kafka-{{ .Discovery.instance }}:9092"
        code:
          type: aptomi/code/kubernetes-helm
          params:
            chartName: kafka-1.0.0
            cluster: "{{ .Labels.cluster }}"

            replicas: 1
            antiAffinity: "soft"

            zookeeper:
              externalAddress: "{{ .Discovery.zookeeper.zookeeper.url }}"

        dependencies:
          - zookeeper
