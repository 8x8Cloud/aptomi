- metadata:
    kind: rule
    namespace: main
    name: analytics_prod_goes_to_us_east
  weight: 1000
  criteria:
    require-all:
      - org == 'it' && is_operator
      - in(service.Labels.type, 'analytics', 'dev-apps', 'service-mesh')
    require-none:
      - team == 'mobile-dev'
  actions:
    change-labels:
      set:
        cluster: cluster-us-east
    dependency: allow

- metadata:
    kind: rule
    namespace: main
    name: analytics_stage_goes_to_us_west
  weight: 2000
  criteria:
    require-all:
      - org == 'dev'
      - in(service.Labels.type, 'analytics', 'dev-apps', 'service-mesh')
    require-none:
      - team == 'mobile-dev'
  actions:
    change-labels:
      set:
        cluster: cluster-us-west
    dependency: allow

- metadata:
    kind: rule
    namespace: main
    name: allow_all_traffic_except_for_deactivated_users
  weight: 3000
  criteria:
    require-none:
      - deactivated
  actions:
    ingress: allow
