# This context describes twitter_stats in staging
- kind: context

  metadata:
    namespace: main
    name: stage-istio

  spec:
    # Only applies to istio service
    # For consumers with org == 'dev'
    criteria:
      require-all:
        - service.Metadata.Name == 'istio'
      require-any:
        - org == 'dev'

    # In stage:
    # - services will be deployed in us-west
    # - each dev will get their own instance
    allocation:
      name: "dev-{{ .User.Name }}-{{ .Labels.tstype }}"
      labels:
        set:
          cluster: cluster-us-west
