<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Aptomi | Home</title>

    <link href="public/css/bootstrap.min.css" rel="stylesheet">
    <link href="public/font-awesome/css/font-awesome.css" rel="stylesheet">

    <link href="public/css/animate.css" rel="stylesheet">
    <link href="public/css/style.css" rel="stylesheet">

    <link href="public/vis/dist/vis-network.min.css" rel="stylesheet" type="text/css"/>
    <link href="public/css/vis-custom.css" rel="stylesheet" type="text/css"/>

    <style>
        #details_graph {
            color: #d3d3d3;
            background-color: #222222;
            border: 1px solid #444444;
            font: 12pt arial;
            width: 100%;
            height: 550px;
        }
    </style>

    <link href="/favicon.ico?v=42" rel="icon">

</head>

<body class="top-navigation">

<!--Main body, usually don't need to change-->
<div id="wrapper">
    <div id="page-wrapper" class="gray-bg">
        <div class="row border-bottom white-bg">
            <nav class="navbar navbar-static-top" role="navigation">
                <div class="navbar-header">
                    <button aria-controls="navbar" aria-expanded="false" data-target="#navbar" data-toggle="collapse" class="navbar-toggle collapsed" type="button">
                        <i class="fa fa-reorder"></i>
                    </button>
                    <a href="#" class="navbar-brand" style="padding: 5px 5px">
                        <img src="public/img/aptomi_logo_2.png" style="height: 40px">
                    </a>
                </div>
                <div class="navbar-collapse collapse" id="navbar">
                    <ul class="nav navbar-nav">
                        <router-link v-for="item in routes" v-bind:to="item.path" tag="li">
                            <a role="button"> {{ item.title }}</a>
                        </router-link>
                    </ul>
                    <ul class="nav navbar-top-links navbar-right">
                        <li>
                            <a href="#">
                                <i class="fa"></i> User: <span>{{ user.name }}</span>
                                &nbsp;
                                <span class="label label-primary pull-right" v-if="user.descr == 'Dev'">{{ user.descr }}</span>
                                <span class="label label-success pull-right" v-if="user.descr == 'Service Ops'">{{ user.descr }}</span>
                                <span class="label label-danger pull-right" v-if="user.descr == 'Global Ops'">{{ user.descr }}</span>
                            </a>
                        </li>
                        <li>
                            <a href="/api/logout?redirect=/ui/login.html">
                                <i class="fa fa-sign-out"></i> Log out
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
        <div class="wrapper wrapper-content">
            <div class="container">
                <router-view></router-view>
            </div>
        </div>
        <div class="footer">
            <!--<div class="pull-right">-->
                <!--10GB of <strong>250GB</strong> Free.-->
            <!--</div>-->
            <div>
                <strong>Copyright</strong> Aptomi &copy; 2017
            </div>
        </div>
        <div class="modal inmodal fade" id="details-modal" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title">Policy evaluation log</h4>
                        <!--<small class="font-bold">Lorem Ipsum is simply dummy text of the printing and typesetting industry.</small>-->
                    </div>
                    <div class="modal-body">

                        <div v-for="obj in obj_view">
                            <div class="table-responsive" v-for="(rules, dep) in obj.RuleLog" v-if="'RuleLog' in obj">
                                <table class="table table-striped">
                                    <h5>Key: {{ obj.Key }}</h5>
                                    <h5>Dependency: {{ dep }}</h5>
                                    <thead>
                                        <tr>
                                            <th>Result </th><!--todo(slukjanov): green/red-->
                                            <th>Type </th>
                                            <th>Scope </th>
                                            <th>Name </th><!--todo(slukjanov): tooltip with message-->
                                            <th>Condition </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="rule in rules" v-if="rule.Type != 'Debug'">
                                            <td v-if="rule.TerminalError"><span class="label label-danger">error</span></td>
                                            <td v-if="!rule.TerminalError && rule.Result"><span class="label label-primary">{{ rule.Result }}</span></td>
                                            <td v-if="!rule.TerminalError && !rule.Result"><span class="label label-warning">{{ rule.Result }}</span></td>
                                            <td>{{ rule.Type }}</td>
                                            <td>{{ rule.Scope }}</td>
                                            <td>{{ rule.Message }}</td>
                                            <td>{{ rule.Condition }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>

                    <!--<div class="modal-footer">-->
                    <!--<button type="button" class="btn btn-white" data-dismiss="modal">Close</button>-->
                    <!--</div>-->
                </div>
            </div>
        </div>
    </div>
</div>

<!--JS-->
<!-- Mainly scripts -->
<script src="public/js/jquery-3.1.1.min.js"></script>
<script src="public/js/bootstrap.min.js"></script>
<script src="public/js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="public/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

<!-- Custom and plugin javascript -->
<script src="public/js/inspinia.js"></script>
<script src="public/js/plugins/pace/pace.min.js"></script>

<!-- Vue JS -->
<script src="public/js/vue.min.js"></script>
<script src="public/js/vue-router.min.js"></script>

<!-- Cookies wrapper -->
<script src="public/js/js.cookie-2.1.4.min.js"></script>

<!-- Work with time -->
<script src="public/js/moment.min.js"></script>

<script type="text/javascript" src="public/vis/dist/vis.js"></script>
<script type="text/javascript" src="public/vis/dist/vis-util.js"></script>

<!--Template for /timeline -->
<script type="text/x-template" id="template-timeline">
    <div class="row animated fadeInRight">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="" id="ibox-content">
                    <div id="vertical-timeline" class="vertical-container light-timeline center-orientation"
                         v-if="timeline.length > 0">

                        <div class="vertical-timeline-block">
                            <div class="vertical-timeline-icon navy-bg">
                                <i class="fa fa-briefcase"></i>
                            </div>

                            <div class="vertical-timeline-content">
                                <h2>Now</h2>
                                <p>This Timeline visualizes all changes applied to Aptomi policies.</p>

                                <a class="btn btn-sm btn-default" v-on:click="toggle_style"> Toggle style</a>

                                <span class="vertical-date">
                                        Now <br/>
                                        <!--<small>Dec 24</small>-->
                                    </span>
                            </div>
                        </div>

                        <div class="vertical-timeline-block" v-for="item in timeline">
                            <div class="vertical-timeline-icon blue-bg">
                                <i class="fa fa-file-text"></i>
                            </div>

                            <div class="vertical-timeline-content">
                                <h2>
                                    Revision: {{ item.revisionNumber }} &nbsp;
                                    ({{ time_ago(item.createdOn) }}) &nbsp;
                                    (<a v-bind:href="'/run/' + item.dir + '/graphics/graph_delta.png'" target="_blank">delta graph</a>)
                                </h2>
                                <p><pre>{{ item.diff }}</pre></p>
                                <span class="vertical-date">
                                        <!--Today <br/>-->
                                        <small>{{ time_nice(item.createdOn) }}</small>
                                    </span>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</script>

<!--Template for /details filter-->
<script type="text/x-template" id="template-details-filter">
    <div class="btn-group">
        <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <span>{{ current_title.length != 0 ? current_title : 'Not available' }}</span>
            &nbsp;
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
            <router-link v-for="item in items"
                         v-bind:to="{ name: 'details', params: { view: target_view.length == 0 ? item.name : target_view, filter: target_view.length != 0 ? item.name : ':filter' } }"
                         tag="li">
                <a> {{ item.title }}</a>
            </router-link>
        </ul>
    </div>
</script>

<!--Template for /details-->
<script type="text/x-template" id="template-details">
    <div>
        <div class="row animated fadeInUp">
            <div class="col-lg-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-content">
                        <div class="row m-b-xs">
                            <div class="col-sm-10">
                                <span class="m-l-xs m-r-sm">View: </span>
                                <details-filter v-bind:items="views" v-bind:current_title="curr_view_title" target_view=""/>

                                <span v-if="items.length > 0" class="m-l-sm m-r-sm">{{ filter_name }}: </span>
                                <details-filter v-if="items.length > 0"
                                                v-bind:items="items" v-bind:current_title="curr_filter_title" v-bind:target_view="curr_view"/>

                            </div>
                            <div class="col-sm-2">
                                <button type="button" class="btn btn-primary" id="rule-log-button"
                                        data-toggle="modal" data-target="#details-modal" style="display: none;">
                                    Rule log
                                </button>
                            </div>
                        </div>
                        <div id="details_graph"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>

<!--Template for /home-->
<script type="text/x-template" id="template-home">
    <div>
        <div class="row animated fadeInUp">
            <div class="col-lg-12">
                <div class="ibox float-e-margins" v-if="summary.globalDependencies.length > 0">
                    <div class="ibox-title">
                        <h5>Global List of services in use</h5>
                    </div>
                    <div class="ibox-content">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                <tr>
                                    <th>Status</th>
                                    <th>User</th>
                                    <th>Consumes</th>
                                    <th>Context</th>
                                    <th>Cluster</th>
                                    <th>Uptime</th>
                                    <th>Action</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr v-for="item in summary.globalDependencies">
                                    <td v-if="item.resolved"><span class="label label-primary">Running</span></td>
                                    <td v-else><span class="label label-danger">Not Running</span></td>
                                    <td>{{ item.userName }}</td>
                                    <td>{{ item.serviceName }}</td>
                                    <td>{{ item.context }}</td>
                                    <td>{{ item.cluster }}</td>
                                    <td>{{ item.stats }}</td>
                                    <td>
                                        <router-link v-bind:to="{ name: 'details', params: { view: 'globalops', filter: item.dependencyId } }">
                                            [Open In Policy Explorer]
                                        </router-link>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="row animated fadeInUp">
            <div class="col-lg-12">
                <div class="ibox float-e-margins" v-if="summary.globalRules.length > 0">
                    <div class="ibox-title">
                        <h5>Global Rules</h5>
                    </div>
                    <div class="ibox-content">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                <tr>
                                    <th>Status</th>
                                    <th>Rule</th>
                                    <th>Conditions</th>
                                    <th>Actions</th>
                                    <th>Applied to</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr v-for="item in summary.globalRules">
                                    <td v-if="item.matchedUsers.length > 0"><span class="label label-primary">Active</span></td>
                                    <td v-else><span class="label label-warning">Inactive</span></td>
                                    <td>{{ item.ruleName }}</td>
                                    <td>
                                        <p v-for="(details, condition) in item.conditions">
                                            {{ condition }}
                                            <ul>
                                                <li v-for="detail in details">{{ detail }}</li>
                                            </ul>
                                        </p>
                                    </td>
                                    <td>
                                        <p v-for="item in item.actions">{{ item }}</p>
                                    </td>
                                    <td>
                                        <p v-for="item in item.matchedUsers">{{ item.Name }} (ID: {{ item.ID }})</p>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="row animated fadeInUp">
            <div class="col-lg-12">
                <div class="ibox float-e-margins" v-if="summary.servicesOwned.length > 0">
                    <div class="ibox-title">
                        <h5>Services I own</h5>
                    </div>
                    <div class="ibox-content">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                <tr>
                                    <th>Status</th>
                                    <th>Service</th>
                                    <th>Context</th>
                                    <th>Cluster</th>
                                    <th>Uptime</th>
                                    <th>Action</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr v-for="item in summary.servicesOwned">
                                    <td><span class="label label-primary">Running</span></td>
                                    <td>{{ item.serviceName }}</td>
                                    <td>{{ item.context }}</td>
                                    <td>{{ item.cluster }}</td>
                                    <td>{{ item.stats }}</td>
                                    <td>
                                        <router-link v-bind:to="{ name: 'details', params: { view: 'service', filter: item.serviceName } }">
                                            [Open In Policy Explorer]
                                        </router-link>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="row animated fadeInUp">
            <div class="col-lg-12">
                <div class="ibox float-e-margins" v-if="summary.servicesUsing.length > 0">
                    <div class="ibox-title">
                        <h5>Services I consume</h5>
                    </div>
                    <div class="ibox-content">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                <tr>
                                    <th>Status</th>
                                    <th>Service</th>
                                    <th>Context</th>
                                    <th>Cluster</th>
                                    <th>Uptime</th>
                                    <th>Action</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr v-for="item in summary.servicesUsing">
                                    <td v-if="item.resolved"><span class="label label-primary">Running</span></td>
                                    <td v-else><span class="label label-danger">Not Running</span></td>
                                    <td>{{ item.serviceName }}</td>
                                    <td>{{ item.context }}</td>
                                    <td>{{ item.cluster }}</td>
                                    <td>{{ item.stats }}</td>
                                    <td>
                                        <router-link v-bind:to="{ name: 'details', params: { view: 'consumer', filter: item.dependencyId } }">
                                            [Open In Policy Explorer]
                                        </router-link>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="row animated fadeInUp" v-for="user_endpoints in all_endpoints">
            <div class="col-lg-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5 v-if="all_endpoints.length > 1 && user_endpoints.Endpoints.length > 0">
                            Services Endpoints for user {{ user_endpoints.User.Name }}
                        </h5>
                        <h5 v-if="all_endpoints.length > 1 && user_endpoints.Endpoints.length == 0">
                            No Services Endpoints for user {{ user_endpoints.User.Name }}
                        </h5>
                        <h5 v-if="all_endpoints.length == 1 && user_endpoints.Endpoints.length > 0">
                            Services Endpoints
                        </h5>
                        <h5 v-if="all_endpoints.length == 1 && user_endpoints.Endpoints.length == 0">
                            No Services Endpoints
                        </h5>
                    </div>
                    <div class="ibox-content" v-if="user_endpoints.Endpoints.length > 0">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                <tr>
                                    <th>Status</th>
                                    <th>Service</th>
                                    <th>Context</th>
                                    <th>Component</th>
                                    <th>Links</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr v-for="endpoint in user_endpoints.Endpoints">
                                    <td><span class="label label-primary">HTTP OK</span></td>
                                    <td>{{ endpoint.Service }}</td>
                                    <td>{{ endpoint.Context }}/{{ endpoint.Allocation }}</td>
                                    <td>{{ endpoint.Component }}</td>
                                    <td>
                                        <div v-for="link in endpoint.Links">
                                            {{ link.Name }}: <a v-bind:href="link.Link">{{ link.Link }}</a>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>

<script type="text/javascript" src="index.js"></script>

</body>

</html>
