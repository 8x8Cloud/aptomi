<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Aptomi | Home</title>

    <link href="public/css/bootstrap.min.css" rel="stylesheet">
    <link href="public/font-awesome/css/font-awesome.css" rel="stylesheet">

    <link href="public/css/animate.css" rel="stylesheet">
    <link href="public/css/style.css" rel="stylesheet">

    <link href="public/vis/dist/vis-network.min.css" rel="stylesheet" type="text/css"/>

    <style>
        #mygraph {
            color: #d3d3d3;
            background-color: #222222;
            border: 1px solid #444444;
            font: 12pt arial;
            width: 100%;
            height: 435px;
        }
    </style>

    <link href="/favicon.ico?v=42" rel="icon">

</head>

<body class="top-navigation">

<!--Main body, usually don't need to change-->
<div id="wrapper">
    <div id="page-wrapper" class="gray-bg">
        <div class="row border-bottom white-bg">
            <nav class="navbar navbar-static-top" role="navigation">
                <div class="navbar-header">
                    <button aria-controls="navbar" aria-expanded="false" data-target="#navbar" data-toggle="collapse" class="navbar-toggle collapsed" type="button">
                        <i class="fa fa-reorder"></i>
                    </button>
                    <a href="#" class="navbar-brand" style="padding: 5px 5px">
                        <img src="public/img/aptomi_logo_2.png" style="height: 40px">
                    </a>
                </div>
                <div class="navbar-collapse collapse" id="navbar">
                    <ul class="nav navbar-nav">
                        <router-link v-for="item in routes" v-bind:to="item.path" tag="li">
                            <a role="button"> {{ item.title }}</a>
                        </router-link>
                    </ul>
                    <ul class="nav navbar-top-links navbar-right">
                        <li>
                            <a href="#">
                                <i class="fa"></i> User: <span>{{ user.name }}</span>
                                &nbsp;
                                <span class="label label-primary pull-right" v-if="user.descr == 'Dev'">{{ user.descr }}</span>
                                <span class="label label-success pull-right" v-if="user.descr == 'Service Op'">{{ user.descr }}</span>
                                <span class="label label-danger pull-right" v-if="user.descr == 'Global Op'">{{ user.descr }}</span>
                            </a>
                        </li>
                        <li>
                            <a href="/api/logout?redirect=/ui/login.html">
                                <i class="fa fa-sign-out"></i> Log out
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
        <div class="wrapper wrapper-content">
            <div class="container">
                <router-view></router-view>
            </div>
        </div>
        <div class="footer">
            <!--<div class="pull-right">-->
                <!--10GB of <strong>250GB</strong> Free.-->
            <!--</div>-->
            <div>
                <strong>Copyright</strong> Aptomi &copy; 2017
            </div>
        </div>
        <div class="modal inmodal fade" id="details-modal" tabindex="-1" role="dialog" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title">Modal title</h4>
                        <small class="font-bold">Lorem Ipsum is simply dummy text of the printing and typesetting industry.</small>
                    </div>
                    <div class="modal-body">

                        <div v-for="obj in obj_view">
                            <div class="table-responsive" v-for="(rules, dep) in obj.RuleLog" v-if="'RuleLog' in obj">
                                <table class="table table-striped">
                                    <h5>Dependency: {{ dep }}</h5>
                                    <thead>
                                        <tr>
                                            <th>Result </th><!--todo(slukjanov): green/red-->
                                            <th>Type </th>
                                            <th>Scope </th>
                                            <th>Name </th><!--todo(slukjanov): tooltip with message-->
                                            <th>Condition </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-for="rule in rules" v-if="rule.Type != 'Debug' && rule.Condition != 'N/A'">
                                            <td>{{ rule.Result }}</td>
                                            <td>{{ rule.Type }}</td>
                                            <td>{{ rule.Scope }}</td>
                                            <td>{{ rule.Name }}</td>
                                            <td>{{ rule.Condition }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                    </div>

                    <!--<div class="modal-footer">-->
                    <!--<button type="button" class="btn btn-white" data-dismiss="modal">Close</button>-->
                    <!--</div>-->
                </div>
            </div>
        </div>
    </div>
</div>

<!--JS-->
<!-- Mainly scripts -->
<script src="public/js/jquery-3.1.1.min.js"></script>
<script src="public/js/bootstrap.min.js"></script>
<script src="public/js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="public/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

<!-- Custom and plugin javascript -->
<script src="public/js/inspinia.js"></script>
<script src="public/js/plugins/pace/pace.min.js"></script>

<!-- Vue JS -->
<script src="public/js/vue.min.js"></script>
<script src="public/js/vue-router.min.js"></script>

<!-- Cookies wrapper -->
<script src="public/js/js.cookie-2.1.4.min.js"></script>

<!-- Work with time -->
<script src="public/js/moment.min.js"></script>

<script type="text/javascript" src="public/vis/dist/vis.js"></script>
<script type="text/javascript" src="public/vis/dist/vis-util.js"></script>

<!--Template for /timeline -->
<script type="text/x-template" id="template-timeline">
    <div class="row animated fadeInRight">
        <div class="col-lg-12">
            <div class="ibox float-e-margins">
                <div class="" id="ibox-content">
                    <div id="vertical-timeline" class="vertical-container light-timeline center-orientation">


                        <div class="vertical-timeline-block">
                            <div class="vertical-timeline-icon navy-bg">
                                <i class="fa fa-briefcase"></i>
                            </div>

                            <div class="vertical-timeline-content">
                                <h2>Now</h2>
                                <p>This Timeline visualizes all changes applied to Aptomi policies.</p>

                                <a class="btn btn-sm btn-default" v-on:click="toggle_style"> Toggle style</a>

                                <span class="vertical-date">
                                        Now <br/>
                                        <!--<small>Dec 24</small>-->
                                    </span>
                            </div>
                        </div>

                        <div class="vertical-timeline-block">
                            <div class="vertical-timeline-icon blue-bg">
                                <i class="fa fa-file-text"></i>
                            </div>

                            <div class="vertical-timeline-content">
                                <h2>Send documents to Mike1111</h2>
                                <p>Lorem Ipsum is simply dummy text of the printing and typesetting industry. Lorem Ipsum has been the industry's standard dummy text ever since.</p>
                                <span class="vertical-date">
                                        Today <br/>
                                        <small>Dec 24</small>
                                    </span>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</script>

<!--JS for /timeline-->
<script>
    const CompTimeline = Vue.component('timeline', {
        template: '#template-timeline',
        data: function () {
            return {
                timeline: []
            }
        },
        created: function () {
            this.fetch_data()
        },
        watch: {
            '$route': 'fetch_data'
        },
        methods: {
            fetch_data: function () {
                var ctx = this;

                loadJSON("/api/summary-view", function (jsonData) {
                    ctx.summary = jsonData;
                    console.log(ctx);
                }, function (err) {
                    console.log("/api/summary-view not loaded with err:");
                    console.log(err);
                });
            },
            toggle_style: function (event) {
//                event.preventDefault();
                $('#vertical-timeline').toggleClass('center-orientation');
            }
        }
    });
</script>

<!--Template for /details filter-->
<script type="text/x-template" id="template-details-filter">
    <div class="btn-group">
        <button type="button" class="btn btn-primary dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            <span>{{ current_title.length != 0 ? current_title : 'Not available' }}</span>
            &nbsp;
            <span class="caret"></span>
        </button>
        <ul class="dropdown-menu">
            <router-link v-for="item in items"
                         v-bind:to="{ name: 'details', params: { view: target_view.length == 0 ? item.name : target_view, filter: target_view.length != 0 ? item.name : ':filter' } }"
                         tag="li">
                <a> {{ item.title }}</a>
            </router-link>
        </ul>
    </div>
</script>

<!--JS for /details/filter-->
<script>
    const CompDetailsFilter = Vue.component('details-filter', {
        template: '#template-details-filter',
        props: ['items', 'current_title', 'target_view']
    })
</script>

<!--Template for /details-->
<script type="text/x-template" id="template-details">
    <div>
        <div class="row animated fadeInUp">
            <div class="col-lg-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-content">
                        <div class="row m-b-xs">
                            <div class="col-sm-10">
                                <span class="m-l-xs m-r-sm">View: </span>
                                <details-filter v-bind:items="views" v-bind:current_title="curr_view_title" target_view=""/>

                                <span v-if="items.length > 0" class="m-l-sm m-r-sm">{{ filter_name }}: </span>
                                <details-filter v-if="items.length > 0"
                                                v-bind:items="items" v-bind:current_title="curr_filter_title" v-bind:target_view="curr_view"/>

                            </div>
                            <div class="col-sm-2">
                                <button type="button" class="btn btn-primary"
                                        data-toggle="modal" data-target="#details-modal">
                                    Rule log
                                </button>
                            </div>
                        </div>
                        <div id="mygraph"></div>
                    </div>
                </div>
            </div>
        </div>
        <div class="row animated fadeInUp">
            <div class="col-lg-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5>Raw data</h5>
                    </div>
                    <div class="ibox-content">
                        <div id="mypanel">No data loaded</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>

<!--JS for drawing charts on /details-->
<script>
    const drawChart = function (inputView, userId, dependencyId, serviceName) {
        console.log("Draw chart with params: ")
        console.log(inputView)
        console.log(userId)
        console.log(dependencyId)
        console.log(serviceName)
        console.log("==== Draw")

        // can be service-view, consumer-view, or globalops-view
        var view = inputView + "-view";

        var apiPath = "/api/" + view;
        if (view === "service-view") {
            // service-view = view from the standpoint of service owner
//            var serviceName = "analytics_pipeline";
            apiPath += "?serviceName=" + serviceName;
        } else if (view === "consumer-view") {
            // consumer-view = view from the standpoint of service consumer
//            var userId = "100";
//            var dependencyId = "" //"alice_tests_twitter_stats_in_stage"; // if you pass dependencyId, it will filter. if you don't, it will show all dependencies of a given user
            apiPath += "?userId=" + userId + "&dependencyId=" + dependencyId;
        } else {
            // globalops-view = view from the standpoint of global IT ops
//            var userId = "100";
            apiPath += "?userId=" + userId + "&dependencyId=" + dependencyId;
        }

        loadJSON(apiPath, jsonLoaded, function (err) {
            console.log(err)
        });

        // create a network
        var container = document.getElementById('mygraph');
        var options = {
            nodes: {
                font: {
                    size: 12,
                    color: 'white'
                },
                borderWidth: 2,
                chosen: {
                    label: false,
                    node: chosenNode
                }
            },
            edges: {
                width: 1,
                font: {
                    size: 12,
                    strokeWidth: 0,
                    color: 'white',
                    align: 'top'
                }
            },
            groups: {
                service: {
                    shape: 'icon',
                    icon: {
                        face: 'FontAwesome',
                        code: '\uf1b2',
                        size: 50,
                        color: 'red'
                    },
                    color: {
                        border: 'red'
                    }
                },
                serviceInstancePrimary: {
                    font: {
                        color: 'black',
                        multi: 'html'
                    },
                    color: {background: 'rgb(0,255,140)', border: 'darkslategrey'},
                    shape: 'box'
                },
                serviceInstance: {
                    font: {
                        color: 'black',
                        multi: 'html'
                    },
                    color: {background: 'rgb(0,123,199)', border: 'darkslategrey'},
                    shape: 'box'
                },
                dependencyShort: {
                    shape: 'icon',
                    icon: {
                        face: 'FontAwesome',
                        code: '\uf007',
                        size: 50,
                        color: 'orange'
                    }
                },
                dependencyLongResolved: {
                    shape: 'icon',
                    font: {
                        multi: 'html'
                    },
                    icon: {
                        face: 'FontAwesome',
                        code: '\uf234',
                        size: 50,
                        color: 'orange'
                    }
                },
                dependencyLongNotResolved: {
                    shape: 'icon',
                    font: {
                        multi: 'html'
                    },
                    icon: {
                        face: 'FontAwesome',
                        code: '\uf235',
                        size: 50,
                        color: 'red'
                    }
                },
                mints: {color: 'rgb(0,255,140)'},
                source: {
                    color: {border: 'white'}
                }
            },
            layout: {
                randomSeed: 239,
                hierarchical: {
                    direction: "LR",
                    levelSeparation: 220
                }
            },
            interaction: {
                hover: true
            },
            physics: false
        };

        // hack to better display consumer view
        if (view === "consumer-view" || view === "globalops-view") {
            options.layout.hierarchical.levelSeparation = 130;
        }

        function chosenNode(values, id, selected, hovering) {
            values.color = "#ffdd88";
            values.borderColor = "#ff0000";
        }

        function clickedNode(params) {
            params.event = "[original event]";
            var node = this.getNodeAt(params.pointer.DOM);
            var edge = this.getEdgeAt(params.pointer.DOM);

            var id = "";
            if (node) {
                id = node
            } else if (edge) {
                id = edge
            }
            if (id) {
                loadJSON("/api/object-view?id=" + id, objectLoaded, objectNotLoaded);
            } else {
                document.getElementById('mypanel').innerHTML = 'No data loaded'
                app.obj_view = [];
            }
        }

        function jsonLoaded(jsonData) {
            var data = {
                nodes: jsonData.nodes,
                edges: jsonData.edges
            };

            var network = new vis.Network(container, data, options);
            network.on("click", clickedNode);
            network.fit();
        }

        function objectLoaded(jsonData) {
            if (jsonData) {
                document.getElementById('mypanel').innerHTML = '<pre>' + JSON.stringify(jsonData, null, 4) + '</pre>';
                app.obj_view = [jsonData];
            } else {
                document.getElementById('mypanel').innerHTML = 'No data loaded'
                app.obj_view = [];
            }
        }

        function objectNotLoaded(err) {
            document.getElementById('mypanel').innerHTML = '<h2>Unable to load data</h2>' + err
            app.obj_view = [];
        }
    };
</script>

<!--JS for /details-->
<script>
    const CompDetails = Vue.component('details', {
        template: '#template-details',
        data: function () {
            return {
                curr_view: "",
                curr_filter: "",

                curr_view_title: "",
                curr_filter_title: "",

                filter_name: "",

                views: [],

                items: []
            }
        },
        created: function () {
            this.fetch_data()
        },
        watch: {
            '$route': 'fetch_data'
        },
        methods: {
            fetch_data: function () {
                var ctx = this;

                $("#mygraph").html("");

                loadJSON("/api/details", function (jsonData) {
                    var view = ctx.$route.params.view;
                    var filter = ctx.$route.params.filter;

                    app.obj_view = [];
                    ctx.views = jsonData.Views;

                    if (view === ":view") {
                        router.push({ name: 'details', params: { view: ctx.views[0].name }});
                        return
                    }

                    ctx.curr_view = view;
                    ctx.curr_filter = filter;

                    var userId = "";
                    var dependencyId = "";
                    var serviceName = "";

                    if (view === "service") {
                        ctx.items = jsonData.Services;
                        ctx.filter_name = "Service";

                        // service-view = view from the standpoint of service owner
                        serviceName = filter
                    } else if (view === "consumer") {
                        ctx.items = jsonData.Dependencies;
                        ctx.filter_name = "Dependency";

                        // consumer-view = view from the standpoint of service consumer
                        userId = jsonData.UserId
                        dependencyId = filter === "all" ? "" : filter
                    } else if (view === "globalops"){
//                        ctx.items = jsonData.Users;
//                        ctx.filter_name = "User";
//                        userId = filter === "all" ? "" : filter

                        ctx.items = jsonData.AllDependencies;
                        ctx.filter_name = "Dependency";
                        dependencyId = filter === "all" ? "" : filter

                        // globalops-view = view from the standpoint of global IT ops

                    }

                    ctx.views.forEach(function(item) {
                        if (item.name === ctx.curr_view) {
                            ctx.curr_view_title = item.title
                        }
                    });

                    ctx.items.forEach(function(item) {
                        if (item.name === ctx.curr_filter) {
                            ctx.curr_filter_title = item.title
                        }
                    });

                    if (filter === ":filter") {
                        if (ctx.items.length > 0) {
                            router.push({name: 'details', params: {view: view, filter: ctx.items[0].name}})
                        }
                        return
                    }

                    drawChart(ctx.curr_view, userId, dependencyId, serviceName)
                }, function (err) {
                    console.log("/api/details not loaded with err:");
                    console.log(err)
                });
            }
        }
    })
</script>

<!--Template for /home-->
<script type="text/x-template" id="template-home">
    <div>
        <div class="row animated fadeInUp">
            <div class="col-lg-12">
                <div class="ibox float-e-margins" v-if="summary.globalDependencies.length > 0">
                    <div class="ibox-title">
                        <h5>Global Dependencies</h5>
                    </div>
                    <div class="ibox-content">
                        <div class="table-responsive">
                            <table class="table table-striped">

                                <!--{-->
                                <!--"cluster": "cluster-us-west",-->
                                <!--"context": "stage/dev-Alice-stage",-->
                                <!--"dependencyId": "alice_tests_twitter_stats_in_stage",-->
                                <!--"id": "Alice",-->
                                <!--"resolved": true,-->
                                <!--"serviceName": "twitter_stats",-->
                                <!--"stats": "-1 containers/1 hour running",-->
                                <!--"userName": "Alice"-->
                                <!--},-->

                                <thead>
                                <tr>
                                    <th>Resolved</th>
                                    <th>User</th>
                                    <th>Depends on</th>
                                    <th>Context</th>
                                    <th>Cluster</th>
                                    <th>Stats</th>
                                    <th>Action</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr v-for="item in summary.globalDependencies">
                                    <td>{{ item.resolved }}</td>
                                    <td>{{ item.userName }}</td>
                                    <td>{{ item.serviceName }}</td>
                                    <td>{{ item.context }}</td>
                                    <td>{{ item.cluster }}</td>
                                    <td>{{ item.stats }}</td>
                                    <td>
                                        <router-link v-bind:to="{ name: 'details', params: { view: 'globalops', filter: item.dependencyId } }">
                                            [View]
                                        </router-link>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="row animated fadeInUp">
            <div class="col-lg-12">
                <div class="ibox float-e-margins" v-if="summary.globalRules.length > 0">
                    <div class="ibox-title">
                        <h5>Global Rules</h5>
                    </div>
                    <div class="ibox-content">
                        <div class="table-responsive">
                            <table class="table table-striped">

                                <!--{-->
                                <!--"appliedTo": "-1 instances",-->
                                <!--"id": "compromised_users_forbid_all_services",-->
                                <!--"ruleName": "compromised_users_forbid_all_services",-->
                                <!--"ruleObject": {-->
                                <!--"Cluster": null,-->
                                <!--"Labels": null,-->
                                <!--"User": {-->
                                <!--"Accept": [-->
                                <!--"deactivated"-->
                                <!--],-->
                                <!--"Reject": []-->
                                <!--}-->
                                <!--}-->
                                <!--},-->

                                <thead>
                                <tr>
                                    <th>Rule</th>
                                    <th>Applied to</th>
                                    <!--<th>Action</th>-->
                                </tr>
                                </thead>
                                <tbody>
                                <tr v-for="item in summary.globalRules">
                                    <td>{{ item.ruleName }}</td>
                                    <td>{{ item.appliedTo }}</td>
                                    <!--<td>[View]</td>-->
                                </tr>
                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="row animated fadeInUp">
            <div class="col-lg-12">
                <div class="ibox float-e-margins" v-if="summary.servicesOwned.length > 0">
                    <div class="ibox-title">
                        <h5>Services I own</h5>
                    </div>
                    <div class="ibox-content">
                        <div class="table-responsive">
                            <table class="table table-striped">

                                <!--{-->
                                <!--"cluster": "cluster-us-east",-->
                                <!--"context": "prod/production",-->
                                <!--"id": "twitter_stats.prod.production.root",-->
                                <!--"serviceName": "twitter_stats",-->
                                <!--"stats": "-1 containers/1 hour running"-->
                                <!--}-->

                                <thead>
                                <tr>
                                    <th>Service</th>
                                    <th>Context</th>
                                    <th>Cluster</th>
                                    <th>Stats</th>
                                    <th>Action</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr v-for="item in summary.servicesOwned">
                                    <td>{{ item.serviceName }}</td>
                                    <td>{{ item.context }}</td>
                                    <td>{{ item.cluster }}</td>
                                    <td>{{ item.stats }}</td>
                                    <td>
                                        <router-link v-bind:to="{ name: 'details', params: { view: 'service', filter: item.serviceName } }">
                                            [View]
                                        </router-link>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="row animated fadeInUp">
            <div class="col-lg-12">
                <div class="ibox float-e-margins" v-if="summary.servicesUsing.length > 0">
                    <div class="ibox-title">
                        <h5>Services I am using</h5>
                    </div>
                    <div class="ibox-content">
                        <div class="table-responsive">
                            <table class="table table-striped">

                                <!--{-->
                                <!--"cluster": "cluster-us-west",-->
                                <!--"context": "stage/dev-Alice-stage",-->
                                <!--"dependencyId": "alice_tests_twitter_stats_in_stage",-->
                                <!--"id": "alice_tests_twitter_stats_in_stage",-->
                                <!--"resolved": true,-->
                                <!--"serviceName": "twitter_stats",-->
                                <!--"stats": "-1 containers/1 hour running"-->
                                <!--},-->

                                <thead>
                                <tr>
                                    <th>Resolved</th>
                                    <th>Service</th>
                                    <th>Context</th>
                                    <th>Cluster</th>
                                    <th>Stats</th>
                                    <th>Action</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr v-for="item in summary.servicesUsing">
                                    <td>{{ item.resolved }} </td>
                                    <td>{{ item.serviceName }}</td>
                                    <td>{{ item.context }}</td>
                                    <td>{{ item.cluster }}</td>
                                    <td>{{ item.stats }}</td>
                                    <td>
                                        <router-link v-bind:to="{ name: 'details', params: { view: 'consumer', filter: item.dependencyId } }">
                                            [View]
                                        </router-link>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>

                    </div>
                </div>
            </div>
        </div>

        <div class="row animated fadeInUp" v-for="user_endpoints in all_endpoints">
            <div class="col-lg-12">
                <div class="ibox float-e-margins">
                    <div class="ibox-title">
                        <h5 v-if="all_endpoints.length > 1 && user_endpoints.Endpoints.length > 0">
                            Services Endpoints for user {{ user_endpoints.User.Name }}
                        </h5>
                        <h5 v-if="all_endpoints.length > 1 && user_endpoints.Endpoints.length == 0">
                            No Services Endpoints for user {{ user_endpoints.User.Name }}
                        </h5>
                        <h5 v-if="all_endpoints.length == 1 && user_endpoints.Endpoints.length > 0">
                            Services Endpoints
                        </h5>
                        <h5 v-if="all_endpoints.length == 1 && user_endpoints.Endpoints.length == 0">
                            No Services Endpoints
                        </h5>
                    </div>
                    <div class="ibox-content" v-if="user_endpoints.Endpoints.length > 0">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                <tr>
                                    <th>Service </th>
                                    <th>Context </th>
                                    <th>Allocation </th>
                                    <th>Component</th>
                                    <th>Links</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr v-for="endpoint in user_endpoints.Endpoints">
                                    <td>{{ endpoint.Service }}</td>
                                    <td>{{ endpoint.Context }}</td>
                                    <td>{{ endpoint.Allocation }}</td>
                                    <td>{{ endpoint.Component }}</td>
                                    <td>
                                        <div v-for="link in endpoint.Links">
                                            <a v-bind:href="link.Link">{{ link.Name }}</a>
                                        </div>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</script>

<!--JS for /home-->
<script>
    const CompHome = Vue.component('home', {
        template: '#template-home',
        data: function () {
            return {
                all_endpoints: {},
                services: 0,
                dependencies: 0,
                summary: {
                    globalDependencies: [],
                    globalRules: [],
                    servicesOwned: [],
                    servicesUsing: []
                }
            }
        },
        created: function () {
            this.fetch_data()
        },
        watch: {
            '$route': 'fetch_data'
        },
        methods: {
            fetch_data: function () {
                var ctx = this;

                loadJSON("/api/summary-view", function (jsonData) {
                    ctx.summary = jsonData;
                    console.log(ctx);
                }, function (err) {
                    console.log("/api/summary-view not loaded with err:");
                    console.log(err);
                });

                loadJSON("/api/details", function (jsonData) {
                    ctx.services = jsonData.Services.length;
                    ctx.dependencies = jsonData.Dependencies.length;
                    console.log(ctx);
                }, function (err) {
                    console.log("/api/details not loaded with err:");
                    console.log(err);
                });

                loadJSON("/api/endpoints", function (jsonData) {
                    ctx.all_endpoints = jsonData.Endpoints;
                    console.log(ctx.all_endpoints);
                }, function (err) {
                    console.log("/api/endpoints not loaded with err:");
                    console.log(err);
                })
            }
        }
    });
</script>

<!--Main Vue JS-->
<script>
    const routes = [
        { name: 'home', path: '/home', title: "Home", component: CompHome },
        { name: 'details', path: '/details/:view/:filter', title: 'Details', component: CompDetails },
        { name: 'timeline', path: '/timeline', title: 'Timeline', component: CompTimeline },
        { path: '*', redirect: { name: 'home' } }
    ];

    const router = new VueRouter({
        routes: routes,
        linkActiveClass: 'active',
        linkExactActiveClass: 'active'
    });

    const app = new Vue({
        el: '#wrapper',
        router: router,
        data: {
            routes: routes,
            obj_view: []
        },
        computed: {
            user: function () {
                return {
                    id:  Cookies.get("logUserId"),
                    name: Cookies.get("logUserName"),
                    descr:  Cookies.get("logUserDescr")
                }
            }
        }
    });

</script>

</body>

</html>
