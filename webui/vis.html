<!DOCTYPE html>
<html>

<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>Aptomi | Home</title>

    <link href="public/css/bootstrap.min.css" rel="stylesheet">
    <link href="public/font-awesome/css/font-awesome.css" rel="stylesheet">

    <link href="public/css/animate.css" rel="stylesheet">
    <link href="public/css/style.css" rel="stylesheet">

    <link href="/favicon.ico?v=42" rel="icon">

    <script type="text/javascript" src="public/vis/dist/vis.js"></script>
    <script type="text/javascript" src="public/vis/dist/vis-util.js"></script>
    <link href="public/vis/dist/vis-network.min.css" rel="stylesheet" type="text/css"/>

    <style>
        #mygraph {
            color: #d3d3d3;
            background-color: #222222;
            border: 1px solid #444444;
            font: 12pt arial;
            width: 100%;
            height: 435px;
        }
    </style>


</head>

<body class="top-navigation">

<div id="wrapper">
    <div id="page-wrapper" class="gray-bg">
        <div class="row border-bottom white-bg">
            <nav class="navbar navbar-static-top" role="navigation">
                <div class="navbar-header">
                    <button aria-controls="navbar" aria-expanded="false" data-target="#navbar" data-toggle="collapse"
                            class="navbar-toggle collapsed" type="button">
                        <i class="fa fa-reorder"></i>
                    </button>
                    <a href="#" class="navbar-brand" style="padding: 5px 5px">
                        <img src="public/img/aptomi_logo_2.png" style="height: 40px">
                    </a>
                </div>
                <div class="navbar-collapse collapse" id="navbar">
                    <ul class="nav navbar-nav">
                        <li>
                            <a aria-expanded="false" role="button" href="/ui/"> Home</a>
                        </li>
                        <li class="active">
                            <a aria-expanded="false" role="button" href="/ui/vis.html"> Services View</a>
                        </li>
                    </ul>
                    <ul class="nav navbar-top-links navbar-right">
                        <li>
                            <a href="#">
                                <i class="fa"></i> [TODO: Select Run]
                            </a>
                        </li>
                        <li>
                            <a href="#">
                                <i class="fa"></i> User: <span id="username"></span>
                            </a>
                        </li>
                        <li>
                            <a href="/api/logout?redirect=/ui/login.html">
                                <i class="fa fa-sign-out"></i> Log out
                            </a>
                        </li>
                    </ul>
                </div>
            </nav>
        </div>
        <div class="wrapper wrapper-content">
            <div class="container">

                <div class="row">

                    <div class="col-lg-9">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <h5 id="viewType"></h5>
                                <div class="ibox-tools">
                                    <a href="#">
                                        <i class="fa"></i>[TODO: Select Service]
                                    </a>
                                    <!--
                                                                        <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                                                            <i class="fa fa-wrench"></i>
                                                                        </a>

                                                                        <ul class="dropdown-menu dropdown-user">
                                                                            <li><a href="#">Config option 1</a>
                                                                            </li>
                                                                            <li><a href="#">Config option 2</a>
                                                                            </li>
                                                                        </ul>
                                    -->
                                </div>
                            </div>
                            <div class="ibox-content">

                                <div id="mygraph"></div>
                                <script type="text/javascript">
                                    // can be service-view, consumer-view, or globalops-view
                                    var view = "consumer-view";

                                    var apiPath = "/api/" + view;
                                    if (view === "service-view") {
                                        // service-view = view from the standpoint of service owner
                                        var serviceName = "analytics_pipeline";
                                        apiPath += "?serviceName=" + serviceName;
                                        document.getElementById('viewType').innerHTML = 'Service Owner View'
                                    } else if (view === "consumer-view") {
                                        // consumer-view = view from the standpoint of service consumer
                                        var userId = "100";
                                        var dependencyId = "alice_tests_twitter_stats_in_stage"; // if you pass dependencyId, it will filter. if you don't, it will show all dependencies of a given user
                                        apiPath += "?userId=" + userId + "&dependencyId=" + dependencyId;
                                        document.getElementById('viewType').innerHTML = 'Service Consumer View'
                                    } else {
                                        // globalops-view = view from the standpoint of global IT ops
                                        var userId = "100";
                                        apiPath += "?userId=" + userId;
                                        document.getElementById('viewType').innerHTML = 'Global IT/Ops View'
                                    }

                                    loadJSON(apiPath, jsonLoaded, function (err) {
                                        console.log('error')
                                    });

                                    // create a network
                                    var container = document.getElementById('mygraph');
                                    var options = {
                                        nodes: {
                                            font: {
                                                size: 12,
                                                color: 'white'
                                            },
                                            borderWidth: 2,
                                            chosen: {
                                                label: false,
                                                node: chosenNode
                                            }
                                        },
                                        edges: {
                                            width: 1,
                                            font: {
                                                size: 12,
                                                strokeWidth: 0,
                                                color: 'white',
                                                align: 'top'
                                            }
                                        },
                                        groups: {
                                            service: {
                                                shape: 'icon',
                                                icon: {
                                                    face: 'FontAwesome',
                                                    code: '\uf1b2',
                                                    size: 50,
                                                    color: 'red'
                                                },
                                                color: {
                                                    border: 'red'
                                                }
                                            },
                                            serviceInstancePrimary: {
                                                font: {
                                                    color: 'black',
                                                    multi: 'html'
                                                },
                                                color: {background: 'rgb(0,255,140)', border: 'darkslategrey'},
                                                shape: 'box'
                                            },
                                            serviceInstance: {
                                                font: {
                                                    color: 'black',
                                                    multi: 'html'
                                                },
                                                color: {background: 'rgb(0,123,199)', border: 'darkslategrey'},
                                                shape: 'box'
                                            },
                                            dependencyShort: {
                                                shape: 'icon',
                                                icon: {
                                                    face: 'FontAwesome',
                                                    code: '\uf007',
                                                    size: 50,
                                                    color: 'orange'
                                                }
                                            },
                                            dependencyLongResolved: {
                                                shape: 'icon',
                                                font: {
                                                    multi: 'html',
                                                },
                                                icon: {
                                                    face: 'FontAwesome',
                                                    code: '\uf234',
                                                    size: 50,
                                                    color: 'orange'
                                                }
                                            },
                                            dependencyLongNotResolved: {
                                                shape: 'icon',
                                                font: {
                                                    multi: 'html'
                                                },
                                                icon: {
                                                    face: 'FontAwesome',
                                                    code: '\uf235',
                                                    size: 50,
                                                    color: 'red'
                                                }
                                            },
                                            mints: {color: 'rgb(0,255,140)'},
                                            source: {
                                                color: {border: 'white'}
                                            }
                                        },
                                        layout: {
                                            randomSeed: 239,
                                            hierarchical: {
                                                direction: "LR",
                                                levelSeparation: 220
                                            }
                                        },
                                        interaction: {
                                            hover: true
                                        },
                                        physics: false
                                    };

                                    // hack to better display consumer view
                                    if (view === "consumer-view") {
                                        options.layout.hierarchical.levelSeparation = 130;
                                    }

                                    function chosenNode(values, id, selected, hovering) {
                                        values.color = "#ffdd88";
                                        values.borderColor = "#ff0000";
                                    }

                                    function clickedNode(params) {
                                        params.event = "[original event]";
                                        var node = this.getNodeAt(params.pointer.DOM);
                                        var edge = this.getEdgeAt(params.pointer.DOM);

                                        var id = "";
                                        if (node) {
                                            id = node
                                        } else if (edge) {
                                            id = edge
                                        }
                                        if (id) {
                                            loadJSON("/api/object-view?id=" + id, objectLoaded, objectNotLoaded);
                                        } else {
                                            document.getElementById('mypanel').innerHTML = 'No data loaded'
                                        }
                                    }

                                    function jsonLoaded(jsonData) {
                                        var data = {
                                            nodes: jsonData.nodes,
                                            edges: jsonData.edges
                                        };

                                        network = new vis.Network(container, data, options);
                                        network.on("click", clickedNode);
                                        network.fit();
                                    }

                                    function objectLoaded(jsonData) {
                                        if (jsonData) {
                                            document.getElementById('mypanel').innerHTML = '<pre>' + JSON.stringify(jsonData, null, 4) + '</pre>';
                                        } else {
                                            document.getElementById('mypanel').innerHTML = 'No data loaded'
                                        }
                                    }

                                    function objectNotLoaded(err) {
                                        document.getElementById('mypanel').innerHTML = '<h2>Unable to load data</h2>' + err
                                    }

                                </script>

                            </div>
                        </div>
                    </div>
                    <div class="col-lg-3">
                        <div class="ibox float-e-margins">
                            <div class="ibox-title">
                                <h5>Details</h5>
                                <div class="ibox-tools">
                                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                                        <i class="fa fa-wrench"></i>
                                    </a>
                                    <ul class="dropdown-menu dropdown-user">
                                        <li><a href="#">Config option 1</a>
                                        </li>
                                        <li><a href="#">Config option 2</a>
                                        </li>
                                    </ul>
                                </div>
                            </div>
                            <div class="ibox-content">
                                <div id="mypanel">No data loaded</div>
                            </div>
                        </div>
                    </div>

                </div>

            </div>

        </div>
        <div class="footer">
            <!--<div class="pull-right">-->
            <!--10GB of <strong>250GB</strong> Free.-->
            <!--</div>-->
            <div>
                <strong>Copyright</strong> Aptomi &copy; 2017
            </div>
        </div>

    </div>
</div>


<!-- Mainly scripts -->
<script src="public/js/jquery-3.1.1.min.js"></script>
<script src="public/js/bootstrap.min.js"></script>
<script src="public/js/plugins/metisMenu/jquery.metisMenu.js"></script>
<script src="public/js/plugins/slimscroll/jquery.slimscroll.min.js"></script>

<!-- Custom and plugin javascript -->
<script src="public/js/inspinia.js"></script>
<script src="public/js/plugins/pace/pace.min.js"></script>

<script>
    function getCookie(c_name) {
        if (document.cookie.length > 0) {
            c_start = document.cookie.indexOf(c_name + "=");
            if (c_start != -1) {
                c_start = c_start + c_name.length + 1;
                c_end = document.cookie.indexOf(";", c_start);
                if (c_end == -1) {
                    c_end = document.cookie.length;
                }
                return unescape(document.cookie.substring(c_start, c_end));
            }
        }
        return "";
    }

    $(document).ready(function () {
        $("#username").text(getCookie("username"));
    });

</script>
</body>

</html>
