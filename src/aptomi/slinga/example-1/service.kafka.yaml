# Definition of Kafka service
name: kafka

labels:

  a: b
  c: d

code:
  helm

# CONTRACT SHOULD BE DEFINED OUTSIDE OF SERVICES

# service execution contexts
contexts:
  # Test context for Kafka
  test:
    # labels used to match a consumer into this context.
    criteria:
      # formulae support TODO [ like "in-test" AND "low-prio-proj" ]

    labels:
      - add x
      - remove y
      - modify z

    labels:
      add:
        - foo: some-test-shit-label
      remove:
        - y
      modify:
        - modify z

    mute-labels:

        (should we do relax-labels, force-labels?)

    # within a context, this is how resources are shared.
    # within a context, this defines per which group of potential consumers a context instance is allocated
    allocation-plan:
      # a group of potential consumers
      if: priority >= 2
        allocate test-{{user.team}}

        add-labels:

        mute-labels:

      if: priority >= 5 && it's like super secure and things need to be awesome
        allocate test-secure-{{user.team}}
        add-labels:

          this shit needs to be super-secure or die

        mute-labels:

        (should we do relax-labels, force-labels?)

  # Production context for Kafka
  prod:
    labels:
      a: b
      c: d
    instances:
      - big => priority >= 5 && org == 'mirantis'
      - small => org == 'mirantis'
      - default => true