# Context definition for prod (high priority)
- metadata:
    kind: context
    namespace: main
    name: prod-high

  criteria:
    require-all:
      - dev == "no" && prod == "yes" && priority >= 200
    require-any:
      - dev == "no"
      - prod == "yes"
      - priority >= 200
    require-none:
      - service.Name == "zookeeper" && nozookeeper

  change-labels:
    set:
      some-test-context-specific-label: some-value
    remove:
      a:
      b:

  allocation:
    keys:
      - "{{.User.Name}}"

# Context definition for prod (low priority)
- metadata:
    kind: context
    namespace: main
    name: prod-low

  criteria:
    require-any:
      - dev == "no" && prod == "yes" && priority < 200
    require-none:
      - service.Name == "zookeeper" && nozookeeper

  change-labels:
    set:
      prod-low-ctx: true
      prod-low-alloc: true
    remove:
      some-label-to-be-removed:

  allocation:
    keys:
      - "team-{{.User.Labels.team}}"
      - "{{index .Labels \"prod-low-ctx\"}}"

# Context definition for test
- metadata:
    kind: context
    namespace: main
    name: test

  criteria:
    require-all:
      - 10 > 5
      - 20 > 10
      - 100 > 50
    require-any:
      - dev == "yes" && prod == "no"
    require-none:
      - service.Name == "zookeeper" && nozookeeper

  change-labels:
    set:
      some-test-context-specific-label: some-value
    remove:
      a:
      b:

  allocation:
    keys:
      - "{{.User.Labels.team}}"

# Special context for testing criterias (none of 'require-any' evaluates to true)
- metadata:
    kind: context
    namespace: main
    name: special-not-matched

  criteria:
    require-all:
      - true
    require-any:
      - never1 == "unbeliveable_value_1"
      - never2 == "unbeliveable_value_2"
      - never3 == "unbeliveable_value_3"
    require-none:
      - false

# Special context for testing criterias ('require-any' is empty)
- metadata:
    kind: context
    namespace: main
    name: special-matched

  criteria:
    require-all:
      - specialname == "specialvalue"
    require-none:
      - false

# Special invalid context with require-all
- metadata:
    kind: context
    namespace: main
    name: special-invalid-require-all

  criteria:
    require-all:
      - specialname + "123")(((

# Special invalid context with require-any
- metadata:
    kind: context
    namespace: main
    name: special-invalid-require-any

  criteria:
    require-any:
      - specialname + "456")(((

# Special invalid context with require-none
- metadata:
    kind: context
    namespace: main
    name: special-invalid-require-none

  criteria:
    require-none:
      - specialname + "789")(((
