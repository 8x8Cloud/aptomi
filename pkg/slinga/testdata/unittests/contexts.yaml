# Context definition for prod (high priority)
- kind: context

  metadata:
    namespace: main
    name: prod-high

  spec:
    criteria:
      require-all:
        - dev == "no" && prod == "yes" && priority >= 200
      require-any:
        - dev == "no"
        - prod == "yes"
        - priority >= 200
      require-none:
        - service.Metadata.Name == "zookeeper" && nozookeeper

    change-labels:
      set:
        some-test-context-specific-label: some-value
      remove:
        a:
        b:

    allocation:
      name: prod
      keys:
        - "{{.User.Name}}"

# Context definition for prod (low priority)
- kind: context

  metadata:
    namespace: main
    name: prod-low

  spec:
    criteria:
      require-any:
        - dev == "no" && prod == "yes" && priority < 200
      require-none:
        - service.Metadata.Name == "zookeeper" && nozookeeper

    change-labels:
      set:
        prod-low-ctx: true
        prod-low-alloc: true
      remove:
        some-label-to-be-removed:

    allocation:
      name: prod
      keys:
        - "team-{{.User.Labels.team}}"
        - "{{index .Labels \"prod-low-ctx\"}}"

# Context definition for test
- kind: context

  metadata:
    namespace: main
    name: test

  spec:
    criteria:
      require-all:
        - 10 > 5
        - 20 > 10
        - 100 > 50
      require-any:
        - dev == "yes" && prod == "no"
      require-none:
        - service.Metadata.Name == "zookeeper" && nozookeeper

    change-labels:
      set:
        some-test-context-specific-label: some-value
      remove:
        a:
        b:

    allocation:
      name: test
      keys:
        - "{{.User.Labels.team}}"

# Special context for testing criterias (none of 'require-any' evaluates to true)
- kind: context

  metadata:
    namespace: main
    name: special-not-matched

  spec:
    criteria:
      require-all:
        - true
      require-any:
        - never1 == "unbeliveable_value_1"
        - never2 == "unbeliveable_value_2"
        - never3 == "unbeliveable_value_3"
      require-none:
        - false

    allocation:
      name: special-not-matched

# Special context for testing criterias ('require-any' is empty)
- kind: context

  metadata:
    namespace: main
    name: special-matched

  spec:
    criteria:
      require-all:
        - specialname == "specialvalue"
      require-none:
        - false

    allocation:
      name: special-matched
