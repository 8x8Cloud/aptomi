# Context definition for prod (high priority)
- kind: context

  metadata:
    namespace: main
    name: prod-high

  spec:
    criteria:
      require-all:
        - dev == "no" && prod == "yes" && priority >= 200
      require-any:
        - dev == "no"
        - prod == "yes"
        - priority >= 200
      require-none:
        - service.Metadata.Name == "zookeeper" && nozookeeper

    change-labels:
      set:
        some-test-context-specific-label: some-value
      remove:
        a:
        b:

    allocation:
      name: prod
      keys:
        - "{{.User.Name}}"

# Context definition for prod (low priority)
- kind: context

  metadata:
    namespace: main
    name: prod-low

  spec:
    criteria:
      require-any:
        - dev == "no" && prod == "yes" && priority < 200
      require-none:
        - service.Metadata.Name == "zookeeper" && nozookeeper

    change-labels:
      set:
        prod-low-ctx: true
        prod-low-alloc: true
      remove:
        some-label-to-be-removed:

    allocation:
      name: prod
      keys:
        - "team-{{.User.Labels.team}}"
        - "{{index .Labels \"prod-low-ctx\"}}"

# Context definition for test
- kind: context

  metadata:
    namespace: main
    name: test

  spec:
    criteria:
      require-all:
        - 10 > 5
        - 20 > 10
        - 100 > 50
      require-any:
        - dev == "yes" && prod == "no"
      require-none:
        - service.Metadata.Name == "zookeeper" && nozookeeper

    change-labels:
      set:
        some-test-context-specific-label: some-value
      remove:
        a:
        b:

    allocation:
      name: test
      keys:
        - "{{.User.Labels.team}}"
